function easeOutElastic(e,t){var o=t-e;return function(r,a){var n=1.70158,s=0,i=o;return 0===r?e:r===a?t:(s||(s=.3*a),i<Math.abs(o)?(i=o,n=s/4):n=s/(2*Math.PI)*Math.asin(o/i),i*Math.pow(2,-10*r)*Math.sin((r*a-n)*(2*Math.PI)/s)+t)}}function easeOut(e,t){return function(o,r){if(0===o)return e;if(o===r-1)return t;var a=o/r-1,n=e,s=t-e,i=-s*(a*a*a*a-1)+n;return i}}function easeInOut(e,t){return function(o,r){if(0===o)return e;if(o===r-1)return t;var a=o/r/2,n=e,s=t-e;return 1>a?s/2*a*a*a*a*a+n:(a-=2,s/2*(a*a*a*a*a+2)+n)}}function adsr(e,t,o,r,a,n,s){return function(i,l){if(o>=i){var c=i/o,h=e,p=t-e,u=p*c+h;return u}if(o+r>=i){var c=(i-o)/r,h=t,p=a-t,u=p*c+h;return u}if(o+r+n>=i)return a;if(o+r+n+s>=i){var c=(i-o-r-n)/s,h=a,p=e-a,u=p*c+h;return u}return 0}}function lfo(e,t,o){return function(r,a){var n=2*Math.PI*r/o;return e+Math.sin(n)*t}}function getLfo(e){return function(t){var o=2*Math.PI*t;return 1+Math.sin(o)*e}}function comboType(e){return ComboTypeTable.length<=e&&(e=ComboTypeTable.length-1),ComboTypeTable[e]}function comma(e){var t=String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");return t}function decodePlayerData(e){return console.log("decodePlayerData",e),e?"number"!=typeof e.level||"number"!=typeof e.stage||"number"!=typeof e.commulativeExp||"number"!=typeof e.commulativeScore?(console.error("decodePlayerData: Invalid, ",e),InitialPlayerData):{level:Math.max(1,Math.min(Math.floor(e.level),LevelOptions.length+1)),stage:Math.max(1,Math.min(Math.floor(e.stage),StageOptions.length+1)),commulativeExp:Math.floor(e.commulativeExp),commulativeScore:Math.floor(e.commulativeScore)}:(console.error("decodePlayerData: Empty"),InitialPlayerData)}function rgbToColor(e,t){var o=e.r,r=e.g,a=e.b;return void 0===t&&(t=void 0),"number"==typeof t?t={r:t,g:t,b:t}:"undefined"==typeof t&&(t={r:0,g:0,b:0}),(o+t.r<<16)+(r+t.g<<8)+(a+t.b)}function createRectShape(e,t,o,r,a,n){var s=new egret.Shape;return s.graphics.beginFill(a),s.graphics.drawRoundRect(e,t,o,r,n),s.graphics.endFill(),s}function createCircleShape(e,t,o,r){var a=new egret.Shape;return a.x=e,a.y=t,a.graphics.beginFill(r),a.graphics.drawCircle(0,0,o),a.graphics.endFill(),a}function createCircleFrameShape(e,t,o,r,a){var n=new egret.Shape;return n.x=e,n.y=t,n.graphics.lineStyle(a,r),n.graphics.drawCircle(0,0,o),n}function createLabelOld(e,t,o,r,a,n,s){var i=new eui.Label;return i.scaleX=a,i.scaleY=a,i.bold=s,i.size=r,i.text=o,i.textColor=n,i.x=e,i.y=t,i.multiline=!0,i}function halign(e,t,o,r){switch(o){case"left":e.anchorOffsetX=0,e.x=t.x-t.anchorOffsetX+r,e.textAlign="left";break;case"center":e.anchorOffsetX=e.width/2,e.x=t.x-t.anchorOffsetX+t.width/2+r,e.textAlign="center";break;case"right":e.anchorOffsetX=e.width,e.x=t.x-t.anchorOffsetX+t.width+r,e.textAlign="right"}}function valign(e,t,o){switch(o){case"top":return t.y;case"center":return t.y+(t.height-e.height)/2;case"bottom":return t.y+t.height-e.height}}function createLabel(e,t,o,r,a){void 0===a&&(a=!1);var n=new eui.Label;return n.bold=a,n.size=o,n.text=e,n.textColor=r,n.multiline=!0,setLabelText(n,e,t),n}function setLabelText(e,t,o){o?e.$positioning=o:o=e.$positioning,e.text=t;var r="undefined"==typeof o.offsetX?0:o.offsetX,a="undefined"==typeof o.offsetY?0:o.offsetY;switch(o.type){case"stage":var n={x:0,y:0,width:EgretGameObject.stageWidth,height:EgretGameObject.stageHeight,anchorOffsetX:0};halign(e,n,o.halign,r),e.y=valign(e,n,o.valign)+a;break;case"next-above":halign(e,o.anchor,o.align,r),e.y=o.anchor.y-e.height+a;break;case"next-below":halign(e,o.anchor,o.align,r),e.y=o.anchor.y+o.anchor.height+a;break;case"next-left":e.x=o.anchor.x-o.anchor.anchorOffsetX-e.width+r,e.y=valign(e,o.anchor,o.align)+a;break;case"next-right":e.x=o.anchor.x-o.anchor.anchorOffsetX+o.anchor.width+r,e.y=valign(e,o.anchor,o.align)+a}return e}var __reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);o.prototype=t.prototype,e.prototype=new o},__assign=this&&this.__assign||Object.assign||function(e){for(var t,o=1,r=arguments.length;r>o;o++){t=arguments[o];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},__awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(a,n){function s(e){try{l(r.next(e))}catch(t){n(t)}}function i(e){try{l(r["throw"](e))}catch(t){n(t)}}function l(e){e.done?a(e.value):new o(function(t){t(e.value)}).then(s,i)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return r([e,t])}}function r(o){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,n&&(s=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[0,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(r){o=[6,r],n=0}finally{a=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var a,n,s,i,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},GameObject=function(){function e(){this.destroyFlag=!1,this.children=[],e.objects.push(this)}return e.allDestroy=function(){e.objects=e.objects.filter(function(e){return e.destroy(),e["delete"](),!1})},e.update=function(){e.objects.forEach(function(e){return e.onUpdate()}),e.objects=e.objects.filter(function(e){return e.destroyFlag&&e["delete"](),!e.destroyFlag}),e.transit&&(e.allDestroy(),e.transit(),e.transit=null)},e.prototype.addChild=function(e){this.children.push(e)},e.prototype.removeChild=function(e,t){void 0===t&&(t=!0);var o=this.children.indexOf(e);if(-1===o)throw new Error("Child not found");var r=this.children[o];this.children.slice(o,1),t&&r.destroy()},e.prototype.removeChildren=function(e){void 0===e&&(e=!0),this.children.forEach(function(e){return e.destroy()}),this.children=[]},e.prototype.destroy=function(){this.destroyFlag=!0,this.removeChildren()},e.prototype.onDestroy=function(){},e.prototype["delete"]=function(){this.onDestroy();var t=e.objects.filter(function(e){return e.destroyFlag!==!0});e.objects=t},e.objects=[],e}();__reflect(GameObject.prototype,"GameObject");var EgretGameObject=function(e){function t(t){void 0===t&&(t=!0);var o=e.call(this)||this;return o.container_=new egret.DisplayObjectContainer,o.container_.name=name,o.visible=t,o}return __extends(t,e),t.init=function(e){t._stageWidth=egret.MainContext.instance.stage.stageWidth,t._stageHeight=egret.MainContext.instance.stage.stageHeight,t.mainStage=e},Object.defineProperty(t,"stageWidth",{get:function(){return t._stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"stageHeight",{get:function(){return t._stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rect",{set:function(e){var t=e.x,o=e.y,r=e.width,a=e.height;this.container_.x=t,this.container_.y=o,this.container_.width=r,this.container_.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return{x:this.container_.x,y:this.container_.y}},set:function(e){var t=e.x,o=e.y;this.container_.x=t,this.container_.y=o},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){this.container_.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchorOffsetX",{set:function(e){this.container_.anchorOffsetX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchorOffsetY",{set:function(e){this.container_.anchorOffsetY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{set:function(e){this.container_.scaleX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{set:function(e){this.container_.scaleY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{set:function(e){this.container_.rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{set:function(e){this.container_.alpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this.container_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return t._stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return t._stageHeight},enumerable:!0,configurable:!0}),t.prototype.addChild=function(e){this.addChildAt(e,void 0)},t.prototype.addChildAt=function(o,r){return e.prototype.addChild.call(this,o),o instanceof t?void this.addEgretDisplayObject(o.container_,r):void console.log("addChild","Not Egret Object")},t.prototype.removeChild=function(o){return o instanceof t?(console.log("removeChild","Egret Object",o),this.removeEgretDisplayObject(o.container_),void e.prototype.removeChild.call(this,o)):void console.log("removeChild","Not Egret Object")},t.prototype.removeChildren=function(){this.container_.removeChildren(),e.prototype.removeChildren.call(this)},t.prototype.addEgretDisplayObject=function(e,t){void 0===t?this.container_.addChild(e):this.container_.addChildAt(e,t)},t.prototype.removeEgretDisplayObject=function(e){this.container_.removeChild(e)},t.prototype.enableTouch=function(){this.container_.touchEnabled=!0,this.container_.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTapped,this)},t.prototype.disableTouch=function(){this.container_.touchEnabled=!1,this.container_.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTapped,this)},t.prototype.onDestroy=function(){this.container_.hasEventListener&&this.container_.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTapped,this),this.container_.parent&&this.container_.parent.removeChild(this.container_),e.prototype.onDestroy.call(this)},t.prototype.onTapped=function(){console.warn("onTapped: unhandled")},t.prototype.onUpdate=function(){console.warn("updateContent: unhandled")},t.prototype.addAsLayer=function(){t.mainStage.addChild(this.container_)},t}(GameObject);__reflect(EgretGameObject.prototype,"EgretGameObject");var EgretLayerGameObject=function(e){function t(){var t=e.call(this,!0)||this;return t.rect={x:0,y:0,width:EgretGameObject.stageWidth,height:EgretGameObject.stageHeight},t.addAsLayer(),t}return __extends(t,e),t}(EgretGameObject);__reflect(EgretLayerGameObject.prototype,"EgretLayerGameObject");var Button=function(e){function t(t,o,r,a,n,s,i){void 0===i&&(i=!0);var l=e.call(this,i)||this;l.innerText=null,l.rect=t;var c=t.x,h=t.y,p=t.width,u=t.height,d=createRectShape(c,h,p,u,n,70);l.addEgretDisplayObject(d);var f=createLabelOld(c,h,s,o,r,a,!0);return f.anchorOffsetX=f.width/2,f.anchorOffsetY=f.height/2,f.x+=p/2,f.y+=u/2,f.textAlign=egret.HorizontalAlign.CENTER,f.verticalAlign=egret.VerticalAlign.MIDDLE,l.addEgretDisplayObject(f),l.innerText=f,l.enableTouch(),l}return __extends(t,e),t.prototype.onDestroy=function(){this.innerText=null,e.prototype.onDestroy.call(this)},t}(EgretGameObject);__reflect(Button.prototype,"Button");var FramesOf4thNote=30,FramesOf8thNote=15,FramesOf16thNote=8,FramesOf32thNote=4,AnimationManager=function(){function e(e,t,o){if(this.queue=[],!t[o])throw new Error("指定したステータス("+o+")は存在しません");this.state_=o,this.counter_=0,this.longCounter=0,this.animations=t,this.object=e}return Object.defineProperty(e.prototype,"counter",{get:function(){return this.counter_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.state_},enumerable:!0,configurable:!0}),e.prototype.next=function(e){var t=this;if(console.log("next",e),Array.isArray(e)){var o=e.shift();e.forEach(function(e){return t.queue.push(e)}),e=o}else this.queue=[];var r=this.animations[e];if(void 0===e)throw new Error("指定したステータス("+this.state_+")は存在しません");r.onStart&&r.onStart(this.object,this.state_,{animation:r,manager:this}),this.state_=e,this.counter_=0},e.prototype.popNext=function(){if(0===this.queue.length)throw new Error("次のステータスが存在しません");var e=this.queue.shift();this.next(e)},e.prototype.update=function(){var e=this.object,t=this.animations[this.state_];if(void 0===t)throw new Error("指定したステータス("+this.state_+")は存在しません");t.alphas&&(t.alphas instanceof Function?e.alpha=t.alphas(this.counter_,t.frames):e.alpha=t.alphas[Math.min(this.counter_,t.alphas.length-1)]),t.scales&&(t.scales instanceof Function?e.scaleX=e.scaleY=t.scales(this.counter_,t.frames):e.scaleX=e.scaleY=t.scales[Math.min(this.counter_,t.scales.length-1)]),t.onFrame&&t.onFrame(e,{animation:t,longCounter:this.longCounter,counter:this.counter_,manager:this}),this.counter_++,this.longCounter++,this.counter_===t.frames&&(t.onComplete?t.onComplete(e,{animation:t,manager:this}):this.counter_=0)},e}();__reflect(AnimationManager.prototype,"AnimationManager");var TheGame=function(){function e(){}return Object.defineProperty(e,"scene",{get:function(){return this.scene_},enumerable:!0,configurable:!0}),e.initFirst=function(t){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(r){switch(r.label){case 0:return EgretGameObject.init(t.stage),e.scene_="loading",e.score_=0,e.player_=void 0,e.currentTurn_=0,e.gameLayer=new GameLayer,e.uiLayer=new UILayer,egret.startTick(e.tickLoop,e),o=e,[4,Social.init(!0)];case 1:return o.player_=r.sent(),e.gotoTitle(),[2]}})})},e.gotoTitle=function(){console.log("TheGame title"),e.scene_="title",e.currentTurn_=0,e.score_=0,e.gameLayer.panels.start(),e.uiLayer.score.visible=!0,e.uiLayer.description.visible=!0},e.start=function(){console.log("TheGame start"),e.uiLayer.score.visible=!0,e.uiLayer.description.visible=!1,e.combo_=-1,e.currentTurn_=1,e.elapsedFramesOfTurn=0,e.elapsedFramesOfSession=0,e.scene_="playing"},Object.defineProperty(e,"currentTurn",{get:function(){return[e.currentTurn_,TurnOptions[e.currentTurn_]]},enumerable:!0,configurable:!0}),e.gotoResult=function(){e.scene_="gameover";var t=e.player;console.log("**************",t);var o={commulativeExp:{from:t.commulativeExp,to:t.commulativeExp+=StageOptions[t.stage-1].expToEarn},commulativeScore:{from:t.commulativeScore,to:t.commulativeScore+=e.score_},isLevelUped:!1,isStageUped:!1};LevelOptions[t.level-1+1].expThreshold<=t.commulativeExp&&(console.log("LEVELUP"),t.level=Math.min(t.level+1,LevelOptions.length+1),o.isLevelUped=!0),StageOptions[t.stage-1+1].scoreThreshold<=t.commulativeScore&&(console.log("NEXT STAGE"),t.stage=Math.min(t.stage+1,StageOptions.length+1),o.isStageUped=!0),Social.updateData(t),t.bestScore<e.score_&&(console.log("HIGH SCORE"),Social.setScore(e.score_).then(function(e){if(e){var o=e.bestScore,r=e.bestRank;t.bestScore=o,t.bestRank=r}}));var r=36865,a=e.score,n=r-a,s=Math.floor(n/365),i=n%365;this.lastResult_=__assign({},o,{stage:e.player_.stage,level:e.player_.level,years:s,days:i}),console.log("LastResult",this.lastResult_),e.gameLayer.panels.gameover(),e.uiLayer.score.visible=!1,e.uiLayer.resultOverlay.show(e.lastResult_)},e.tickLoop=function(t){GameObject.update();var o=e.currentTurn,r=o[1];switch(e.scene_){case"loading":break;case"title":break;case"playing":e.elapsedFramesOfSession+=1,e.elapsedFramesOfTurn+=1,r.framesOfTurn<e.elapsedFramesOfTurn&&(console.log("TIME OVER"),e.miss()),e.FRAMES_A_SESSION<e.elapsedFramesOfSession&&e.gotoResult();break;case"gameover":}return!1},Object.defineProperty(e,"remaingMiliseconds",{get:function(){return(e.FRAMES_A_SESSION-e.elapsedFramesOfSession)/e.FPS},enumerable:!0,configurable:!0}),Object.defineProperty(e,"lastResult",{get:function(){return e.lastResult_},enumerable:!0,configurable:!0}),Object.defineProperty(e,"player",{get:function(){return this.player_},enumerable:!0,configurable:!0}),Object.defineProperty(e,"score",{get:function(){return this.score_},enumerable:!0,configurable:!0}),Object.defineProperty(e,"currentComboType",{get:function(){return comboType(e.combo_)},enumerable:!0,configurable:!0}),e.gotCorrectPanel=function(t){"playing"!==e.scene&&e.start();var o=LevelOptions[e.player.level-1].scoreBoost;console.log("boost",o);var r=e.currentTurn_*(1+o);e.combo_++,1<e.combo_&&(r*=e.combo_),e.score_+=Math.floor(r),e.currentTurn_=Math.min(e.currentTurn_+1,e.MAX_LEVEL),e.nextTurn()},e.gotWrongPanel=function(t){e.miss()},e.miss=function(){"playing"===e.scene_&&(e.combo_=-1,e.currentTurn_=Math.max(e.currentTurn_-1,1),e.nextTurn())},e.nextTurn=function(){console.log("TheGame nextTurn"),e.elapsedFramesOfTurn=0,e.gameLayer.panels.nextPanels()},e.MAX_LEVEL=50,e.FPS=60,e.FRAMES_A_SESSION=100*FramesOf4thNote,e}();__reflect(TheGame.prototype,"TheGame");var UILayer=function(e){function t(){var t=e.call(this)||this;return t.addChild(t.score=new ScoreUI),t.addChild(t.description=new Description),t.addChild(t.timelimit=new TimeLimit),t.addChild(t.resultOverlay=new ResultOverlay),t}return __extends(t,e),t.prototype.onUpdate=function(){},t}(EgretLayerGameObject);__reflect(UILayer.prototype,"UILayer");var Background=function(e){function t(){var t=e.call(this)||this,o=createRectShape(0,0,EgretGameObject.stageWidth,EgretGameObject.stageHeight,ColorPallet.BACKGROUND,0);return t.addEgretDisplayObject(o),t}return __extends(t,e),t.prototype.onUpdate=function(){},t}(EgretGameObject);__reflect(Background.prototype,"Background");var EffectLabel=function(e){function t(t,o,r,a,n,s){var i=e.call(this)||this;return i.rect={x:t,y:o,width:r,height:a},i.animation=0,i.originalY=0,i.label=createLabelOld(t,o,s,70,.5,n,!0),i.label.alpha=.2,i.label.anchorOffsetX=i.label.width/2,i.label.anchorOffsetY=i.label.height/2,i.addEgretDisplayObject(i.label),i}return __extends(t,e),t.prototype.onDestroy=function(){this.label=null,e.prototype.onDestroy.call(this)},t.prototype.onUpdate=function(){this.animation<20||(this.animation<40?(this.label.y=this.label.y-1,this.label.alpha=20):this.destroy())},t}(EgretGameObject);__reflect(EffectLabel.prototype,"EffectLabel");var Panel=function(e){function t(o,r,a,n,s){var i=e.call(this)||this;i.correctFlag=!1,i.position=r,i.level=o,i.radius=90,i.correctFlag=n;var l=0===Math.floor(2*Math.random())?1:-1,c=l*o.depthColor,h=void 0;return h=n?rgbToColor(a,c):rgbToColor(a),i.color=h,i.addEgretDisplayObject(createCircleShape(0,0,i.radius,h)),i.addEgretDisplayObject(createCircleShape(0,-i.radius+16,8,16777215)),i.enableTouch(),i.animationManager=new AnimationManager(i,t.animations,s),i}return __extends(t,e),t.prototype.onTapped=function(){"loading"!==TheGame.scene&&-1!==["on","waiting"].indexOf(this.animationManager.state)&&(this.correctFlag?(TheGame.gotCorrectPanel(this),this.animationManager.next(["tap","out-success"])):"playing"===TheGame.scene?(TheGame.gotWrongPanel(this),this.animationManager.next(["tap","out-miss"])):this.animationManager.next(["tap","on"]))},t.prototype.onUpdate=function(){this.animationManager.update()},t.prototype.start=function(){this.animationManager.next("in")},t.prototype.out=function(){this.animationManager.next("out")},t.prototype.gameover=function(){this.animationManager.next("out-gameover")},t.animations={waiting:{frames:2*FramesOf4thNote,scales:adsr(.95,1,2,2,.97,FramesOf4thNote-2,FramesOf4thNote),alphas:adsr(.95,1,2,2,.97,FramesOf4thNote-2,FramesOf4thNote),onFrame:function(e,t){var o=(t.animation,t.longCounter);e.rotation=360*o/(16*FramesOf4thNote)}},"in":{frames:FramesOf8thNote,scales:[0,.05,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,.95,1],onComplete:function(e,t){var o=t.manager;o.next("on")}},on:{frames:1*FramesOf4thNote,scales:adsr(.95,1.05,2,0,1.05,0,FramesOf4thNote),onFrame:function(e,t){var o=(t.animation,t.longCounter);e.rotation=360*o/e.level.framesOfTurn}},tap:{frames:FramesOf16thNote,scales:[1,.8,.85,.95,1.05,1.1,1],onComplete:function(e,t){var o=t.manager;o.popNext()}},out:{frames:FramesOf8thNote,alphas:[1,.95,.9,.85,.8,.7,.6,.5,.4,.3,.199999999999999,.15,.1,.05,0],scales:[1,1.005,1.01,1.02,1.03,1.04,1.08,1.1,1.1,1.05,1.75,1.85,1.9,1.95,2],onComplete:function(e,t){e.destroy()}},"out-success":{frames:FramesOf8thNote,alphas:[1,.95,.9,.85,.8,.7,.6,.5,.4,.3,.199999999999999,.15,.1,.05,0],scales:[1,1.005,1.01,1.02,1.03,1.04,1.08,1.1,1.1,1.05,1.75,1.85,1.9,1.95,2],onStart:function(e,t){var o=e.position,r=o.x,a=o.y,n=TheGame.currentComboType;TheGame.gameLayer.panels.addChild(new PanelCorrectHitEffect(n,r,a,e.radius,e.color))},onComplete:function(e,t){e.destroy()}},"out-miss":{frames:FramesOf8thNote,scales:[1,.95,.9,.8,.7,.5,.4,.3,.4,.6,.5,.4,.2,.1,0],onComplete:function(e,t){e.destroy()}},"out-gameover":{frames:2*FramesOf4thNote,alphas:easeOut(1,0),scales:easeOut(1,0),onStart:function(e,t){var o=e.position,r=o.x,a=o.y;TheGame.gameLayer.panels.addChild(new PanelGameoverEffect("best",r,a,e.radius))},onComplete:function(e,t){var o=t.manager;o.next("in-result")}},"in-result":{frames:FramesOf8thNote,scales:[0,.05,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,.95,1],onStart:function(e){e.alpha=1},onComplete:function(e,t){var o=t.manager;o.next("result")}},result:{frames:1*FramesOf4thNote,scales:adsr(.95,1.05,2,0,1.05,0,FramesOf4thNote),onFrame:function(e,t){var o=(t.animation,t.longCounter);e.rotation=360*o/(16*FramesOf4thNote)}}},t}(EgretGameObject);__reflect(Panel.prototype,"Panel");var PanelCorrectHitEffect=function(e){function t(o,r,a,n,s){var i=e.call(this)||this;return i.position={x:r,y:a},i.animationManager=new AnimationManager(i,t.animations,o),t.shapes[o].shapes.forEach(function(e){i.addEgretDisplayObject(createCircleFrameShape(0,0,n*e.radius,e.color,e.lineWidth))}),i}return __extends(t,e),t.prototype.onUpdate=function(){this.animationManager.update()},t.animations={single:{frames:1*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}},combo1:{frames:2*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}},combo2:{frames:4*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}},combo3:{frames:6*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}},combo4:{frames:8*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}}},t.shapes={single:{shapes:[{radius:1.1,color:16777215,lineWidth:4}]},combo1:{shapes:[{radius:1.1,color:16777215,lineWidth:4},{radius:1.2,color:16764159,lineWidth:6}]},combo2:{shapes:[{radius:1.1,color:16777215,lineWidth:4},{radius:1.2,color:16764159,lineWidth:6},{radius:1.4,color:13434879,lineWidth:8}]},combo3:{shapes:[{radius:1.1,color:16777215,lineWidth:4},{radius:1.2,color:16764159,lineWidth:6},{radius:1.4,color:13434879,lineWidth:8},{radius:1.8,color:16777164,lineWidth:10}]},combo4:{shapes:[{radius:1.1,color:16777215,lineWidth:4},{radius:1.2,color:16764159,lineWidth:6},{radius:1.4,color:13434879,lineWidth:8},{radius:1.8,color:16777164,lineWidth:10},{radius:2.6,color:13421772,lineWidth:12}]}},t}(EgretGameObject);__reflect(PanelCorrectHitEffect.prototype,"PanelCorrectHitEffect");var PanelGameoverEffect=function(e){function t(o,r,a,n){var s=e.call(this)||this;return s.position={x:r,y:a},s.animationManager=new AnimationManager(s,t.animations,o),t.shapes[o].shapes.forEach(function(e){s.addEgretDisplayObject(createCircleFrameShape(0,0,n*e.radius,e.color,e.lineWidth))}),s}return __extends(t,e),t.prototype.onUpdate=function(){this.animationManager.update()},t.animations={normal:{frames:4*FramesOf4thNote,scales:easeOut(1,1.05),alphas:easeOut(.4,0),onComplete:function(e,t){e.destroy()}},best:{frames:4*FramesOf4thNote,scales:easeOut(1,1.2),alphas:easeOut(.6,0),onComplete:function(e,t){e.destroy()}}},t.shapes={normal:{shapes:[{radius:1.1,color:16777215,lineWidth:4}]},best:{shapes:[{radius:1.1,color:16711680,lineWidth:4},{radius:1.2,color:16773376,lineWidth:6},{radius:1.4,color:10966952,lineWidth:8},{radius:1.8,color:16777215,lineWidth:10}]}},t}(EgretGameObject);__reflect(PanelGameoverEffect.prototype,"PanelGameoverEffect");var Panels=function(e){function t(){var t=e.call(this)||this;return t.panels=[],t.counterToCreate=void 0,t}return __extends(t,e),t.prototype.start=function(){this.removeChildren(),this.panels=[],this.createPanels("waiting")},t.prototype.nextPanels=function(){this.counterToCreate=0,this.panels.forEach(function(e){return e.out()})},t.prototype.createPanels=function(e){var t=TheGame.currentTurn,o=t[1];console.log("createPanels:",o);for(var r=o.rowcol,a=r[0],n=r[1],s=a*n,i=Math.floor(Math.random()*s),l=200,c={r:Math.floor(150*Math.random()+50),g:Math.floor(150*Math.random()+50),b:Math.floor(150*Math.random()+50)},h=(EgretGameObject.stageWidth-l*a+l)/2,p=(EgretGameObject.stageHeight-l*n+l)/2+100,u=0;s>u;u++){var d=u%a,f=(u-d)/a,m={x:d*l+h,y:f*l+p},g=new Panel(o,m,c,i===u,e);this.addChild(g),this.panels.push(g)}},t.prototype.onDestroy=function(){this.panels=void 0,e.prototype.onDestroy.call(this)},t.prototype.gameover=function(){this.panels.forEach(function(e){return e.gameover()})},t.prototype.onUpdate=function(){"undefined"!=typeof this.counterToCreate&&(this.counterToCreate--,this.counterToCreate<=0&&(this.panels=[],this.counterToCreate=void 0,this.createPanels("in")))},t}(EgretGameObject);__reflect(Panels.prototype,"Panels");var ComboTypeTable=["single","combo1","combo2","combo2","combo3","combo3","combo3","combo4"],LevelOptions=[{expThreshold:0,scoreBoost:0},{expThreshold:900,scoreBoost:.02},{expThreshold:2500,scoreBoost:.04},{expThreshold:5500,scoreBoost:.06},{expThreshold:9100,scoreBoost:.08},{expThreshold:14e3,scoreBoost:.1},{expThreshold:20400,scoreBoost:.12},{expThreshold:28500,scoreBoost:.14},{expThreshold:37500,scoreBoost:.16},{expThreshold:47400,scoreBoost:.18},{expThreshold:59400,scoreBoost:.2},{expThreshold:72400,scoreBoost:.22},{expThreshold:87800,scoreBoost:.24},{expThreshold:104300,scoreBoost:.26},{expThreshold:121900,scoreBoost:.28},{expThreshold:142300,scoreBoost:.3},{expThreshold:163900,scoreBoost:.32},{expThreshold:186700,scoreBoost:.34},{expThreshold:210700,scoreBoost:.36},{expThreshold:235900,scoreBoost:.38},{expThreshold:264500,scoreBoost:.4},{expThreshold:294400,scoreBoost:.42},{expThreshold:325600,scoreBoost:.44},{expThreshold:358100,scoreBoost:.46},{expThreshold:391900,scoreBoost:.48},{expThreshold:429700,scoreBoost:.5},{expThreshold:468900,scoreBoost:.52},{expThreshold:509500,scoreBoost:.54},{expThreshold:551500,scoreBoost:.56},{expThreshold:594900,scoreBoost:.58},{expThreshold:639700,scoreBoost:.6},{expThreshold:689200,scoreBoost:.62},{expThreshold:740200,scoreBoost:.64},{expThreshold:792700,scoreBoost:.66},{expThreshold:846700,scoreBoost:.68},{expThreshold:902200,scoreBoost:.7},{expThreshold:959200,scoreBoost:.72},{expThreshold:1017700,scoreBoost:.74},{expThreshold:1077700,scoreBoost:.76},{expThreshold:1139200,scoreBoost:.78},{expThreshold:1206400,scoreBoost:.8},{expThreshold:1275200,scoreBoost:.82},{expThreshold:1345600,scoreBoost:.84},{expThreshold:1417600,scoreBoost:.86},{expThreshold:1491200,scoreBoost:.88},{expThreshold:1566400,scoreBoost:.9},{expThreshold:1643200,scoreBoost:.92},{expThreshold:1721600,scoreBoost:.94},{expThreshold:1801600,scoreBoost:.96},{expThreshold:1883200,scoreBoost:.98},{expThreshold:1971600,scoreBoost:1},{expThreshold:2061700,scoreBoost:1.02},{expThreshold:2153500,scoreBoost:1.04},{expThreshold:2247e3,scoreBoost:1.06},{expThreshold:2342200,scoreBoost:1.08},{expThreshold:2439100,scoreBoost:1.1},{expThreshold:2537700,scoreBoost:1.12},{expThreshold:2638e3,scoreBoost:1.14},{expThreshold:274e4,scoreBoost:1.16},{expThreshold:2843700,scoreBoost:1.18},{expThreshold:2949100,scoreBoost:1.2},{expThreshold:3056200,scoreBoost:1.22},{expThreshold:3165e3,scoreBoost:1.24},{expThreshold:3282e3,scoreBoost:1.26},{expThreshold:3400800,scoreBoost:1.28},{expThreshold:3521400,scoreBoost:1.3},{expThreshold:3643800,scoreBoost:1.32},{expThreshold:3768e3,scoreBoost:1.34},{expThreshold:3894e3,scoreBoost:1.36},{expThreshold:4021800,scoreBoost:1.38},{expThreshold:4151400,scoreBoost:1.4},{expThreshold:4282800,scoreBoost:1.42},{expThreshold:4416e3,scoreBoost:1.44},{expThreshold:4551e3,scoreBoost:1.46},{expThreshold:4687800,scoreBoost:1.48},{expThreshold:4826400,scoreBoost:1.5},{expThreshold:4966800,scoreBoost:1.52},{expThreshold:5109e3,scoreBoost:1.54},{expThreshold:5253e3,scoreBoost:1.56},{expThreshold:5398800,scoreBoost:1.58},{expThreshold:5554600,scoreBoost:1.6},{expThreshold:5712300,scoreBoost:1.62},{expThreshold:5871900,scoreBoost:1.64},{expThreshold:6033400,scoreBoost:1.66},{expThreshold:6196800,scoreBoost:1.68},{expThreshold:6362100,scoreBoost:1.7},{expThreshold:6529300,scoreBoost:1.72},{expThreshold:6698400,scoreBoost:1.74},{expThreshold:6869400,scoreBoost:1.76},{expThreshold:7042300,scoreBoost:1.78},{expThreshold:7217100,scoreBoost:1.8}],StageOptions=[{scoreThreshold:0,expToEarn:300},{scoreThreshold:65e3,expToEarn:600},{scoreThreshold:176300,expToEarn:900},{scoreThreshold:327500,expToEarn:1200},{scoreThreshold:510400,expToEarn:1500},{scoreThreshold:721200,expToEarn:1800},{scoreThreshold:955200,expToEarn:2100},{scoreThreshold:1213600,expToEarn:2400},{scoreThreshold:1490500,expToEarn:2700},{scoreThreshold:1801300,expToEarn:3e3},{scoreThreshold:2124700,expToEarn:3300},{scoreThreshold:2484700,expToEarn:3600},{scoreThreshold:2858200,expToEarn:3900},{scoreThreshold:3245200,expToEarn:4200},{scoreThreshold:3672400,expToEarn:4500},{scoreThreshold:4114e3,expToEarn:4800},{scoreThreshold:457e4,expToEarn:5100},{scoreThreshold:506e4,expToEarn:5400},{scoreThreshold:5575100,expToEarn:5700},{scoreThreshold:6105500,expToEarn:6e3},{scoreThreshold:6651200,expToEarn:6300},{scoreThreshold:7223200,expToEarn:6600},{scoreThreshold:7833400,expToEarn:6900},{scoreThreshold:8459800,expToEarn:7200},{scoreThreshold:9102400,expToEarn:7500},{scoreThreshold:9761200,expToEarn:7800},{scoreThreshold:10436200,expToEarn:8100},{scoreThreshold:11153e3,expToEarn:8400},{scoreThreshold:11899700,expToEarn:8700},{scoreThreshold:12663500,expToEarn:9e3},{scoreThreshold:13444400,expToEarn:9300}],TurnOptions=[{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:50},{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:50},{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:50},{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:45},{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:45},{rowcol:[2,2],framesOfTurn:4*FramesOf4thNote,depthColor:40},{rowcol:[2,2],framesOfTurn:3*FramesOf4thNote,depthColor:45},{rowcol:[2,2],framesOfTurn:3*FramesOf4thNote,depthColor:45},{rowcol:[2,2],framesOfTurn:3*FramesOf4thNote,depthColor:40},{rowcol:[2,2],framesOfTurn:3*FramesOf4thNote,depthColor:40},{rowcol:[2,2],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[2,3],framesOfTurn:4*FramesOf4thNote,depthColor:50},{rowcol:[2,3],framesOfTurn:4*FramesOf4thNote,depthColor:50},{rowcol:[2,3],framesOfTurn:4*FramesOf4thNote,depthColor:45},{rowcol:[2,3],framesOfTurn:4*FramesOf4thNote,depthColor:45},{rowcol:[2,3],framesOfTurn:4*FramesOf4thNote,depthColor:40},{rowcol:[2,3],framesOfTurn:3*FramesOf4thNote,depthColor:45},{rowcol:[2,3],framesOfTurn:3*FramesOf4thNote,depthColor:45},{rowcol:[2,3],framesOfTurn:3*FramesOf4thNote,depthColor:40},{rowcol:[2,3],framesOfTurn:3*FramesOf4thNote,depthColor:40},{rowcol:[2,3],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[3,3],framesOfTurn:4*FramesOf4thNote,depthColor:40},{rowcol:[3,3],framesOfTurn:4*FramesOf4thNote,depthColor:40},{rowcol:[3,3],framesOfTurn:4*FramesOf4thNote,depthColor:35},{rowcol:[3,3],framesOfTurn:4*FramesOf4thNote,depthColor:35},{rowcol:[3,3],framesOfTurn:4*FramesOf4thNote,depthColor:30},{rowcol:[3,3],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[3,3],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[3,3],framesOfTurn:3*FramesOf4thNote,depthColor:30},{rowcol:[3,3],framesOfTurn:3*FramesOf4thNote,depthColor:30},{rowcol:[3,3],framesOfTurn:3*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[3,4],framesOfTurn:3*FramesOf4thNote,depthColor:35},{rowcol:[3,4],framesOfTurn:3*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:3*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:3*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:2*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:2*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:2*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:2*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:2*FramesOf4thNote,depthColor:20},{rowcol:[3,4],framesOfTurn:1.5*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:1.5*FramesOf4thNote,depthColor:30},{rowcol:[3,4],framesOfTurn:1.5*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:1.5*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:1.5*FramesOf4thNote,depthColor:20},{rowcol:[3,4],framesOfTurn:1*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:1*FramesOf4thNote,depthColor:25},{rowcol:[3,4],framesOfTurn:1*FramesOf4thNote,depthColor:20},{rowcol:[3,4],framesOfTurn:1*FramesOf4thNote,depthColor:20},{rowcol:[3,4],framesOfTurn:1*FramesOf4thNote,depthColor:15}],ColorPallet;
!function(e){e[e.BACKGROUND=2236945]="BACKGROUND",e[e.BUTTON_LABEL=15658734]="BUTTON_LABEL",e[e.BUTTON_BACKGROUND=3355443]="BUTTON_BACKGROUND",e[e.GAMEOVER_BACKGROUND=2236945]="GAMEOVER_BACKGROUND",e[e.GAMEOVER_TEXT=3355443]="GAMEOVER_TEXT",e[e.UI_TEXT=15658734]="UI_TEXT",e[e.RESULT_TEXT_COLOR=15658734]="RESULT_TEXT_COLOR"}(ColorPallet||(ColorPallet={}));var GameLayer=function(e){function t(){var t=e.call(this)||this;return t.addChild(new Background),t.addChild(t.panels=new Panels),t}return __extends(t,e),t.prototype.onUpdate=function(){},t}(EgretLayerGameObject);__reflect(GameLayer.prototype,"GameLayer");var Main=function(e){function t(){var o=e.call(this)||this;return t.I=o,o.once(egret.Event.ADDED_TO_STAGE,o.addToStage,o),o}return __extends(t,e),t.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,TheGame.initFirst(this)];case 1:return e.sent(),[2]}})})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var InitialPlayerData={level:1,stage:1,commulativeExp:0,commulativeScore:0},AnonymousPlayerProfile={name:"???",avatarUrl:"???"},InitialPlayerLeaderboard={bestScore:0,bestRank:void 0},Sdk=function(){function e(){}return e.loadSdk=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o;return __generator(this,function(r){switch(r.label){case 0:return console.log("============================================================"),console.log("Liberapp.loadSdk:"),this.env=this.detectMode(location.origin),console.log("env: ",this.env),e=this.resolveSdkUrl(this.sdkPath),console.log("srcUrl: ",e),[4,this.loadScript(e)];case 1:return t=r.sent(),console.log("script:",t),o=window.LiberappSdk,"egret-wing"!==this.env?[3,3]:[4,o.enableDebug()];case 2:r.sent(),r.label=3;case 3:return console.log("liberappSdk:",o),[2,o]}})})},e.detectMode=function(e){return/^https:\/\/(.+)\.a\.liberapp\.net$/.test(e)?"production":/^https:\/\/(.+)\.a\.staging.\.liberapp\.net$/.test(e)?"staging":/^https:\/\/(.+)\.a\.development\.liberapp\.net$/.test(e)?"development":"egret-wing"},e.resolveSdkUrl=function(e){var t=this.baseUrls[this.env];return""+t+e},e.loadScript=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,o){var r=document.createElement("script");r.async=!1,r.src=e,r.onload=function(){return t(r)},r.onerror=function(){return o(new Error("Can not load script: src:"+e))},document.head.append(r)})]})})},e.baseUrls={production:"https://liberapp.net",staging:"https://staging.liberapp.net",development:"https://localhost","egret-wing":"https://staging.liberapp.net"},e.sdkPath="/dist/sdk/liberapp-ja-0_9.js",e}();__reflect(Sdk.prototype,"Sdk");var Social=function(){function e(){}return e.init=function(e){return __awaiter(this,void 0,void 0,function(){var t,o,r,a,n,s,i,l,c,h,p,u,d;return __generator(this,function(f){switch(f.label){case 0:return e?[4,Sdk.loadSdk()]:[2,__assign({},AnonymousPlayerProfile,InitialPlayerData,InitialPlayerLeaderboard)];case 1:return t=f.sent(),this.sdk=t,Toast.show({text:"ログイン中・・・",delay:3e4,canHide:!0}),[4,t.initializeAsync()];case 2:return f.sent(),[4,t.startGameAsync()];case 3:return f.sent(),this.sdk.player?(o={name:t.player.getName(),avatarUrl:t.player.getPhoto()},Toast.show({text:o.name+"さんようこそ！",delay:3e4,canHide:!0}),r=this,[4,t.getLeaderboardAsync("default")]):(this.sdk=void 0,[2]);case 4:return r.leaderboard=f.sent(),[4,Promise.all([this.leaderboard.getEntryCountAsync(),this.leaderboard.getEntriesAsync(3,0),this.leaderboard.getPlayerEntryAsync(),this.sdk.player.getDataAsync(Object.keys(InitialPlayerData))])];case 5:return a=f.sent(),n=a[0],s=a[1],i=a[2],l=a[3],c=decodePlayerData(l),i?(h={bestRank:i.getRank(),bestScore:i.getScore()},Toast.show({text:"今のところ"+n+"人中"+h.bestRank+"位です",delay:3e3})):(h=InitialPlayerLeaderboard,p=s[0],p&&(console.log(p),u=p.getPlayer().getName(),d=p.getScore(),Toast.show({text:n+"人が遊んでいます!\n一番は"+u+"さん\nスコアは"+d+"です",delay:3e3}))),[2,__assign({},o,c,h)]}})})},e.updateData=function(e){if(console.log("updateData "+e),!this.sdk||!this.sdk.player)return void console.log("データを保存しません");var t={commulativeExp:e.commulativeExp,commulativeScore:e.commulativeScore,level:e.level,stage:e.stage},o=this.sdk.player.setDataAsync(t);o.then(function(){return console.log("保存完了")})},e.setScore=function(e){return __awaiter(this,void 0,void 0,function(){var t,o,r;return __generator(this,function(a){switch(a.label){case 0:return console.log("setScore "+e),this.leaderboard?(Toast.show({text:"ハイスコアを送信中",delay:3e4,canHide:!0}),[4,this.leaderboard.setScoreAsync(e)]):(console.log("ハイスコアを送信しません"),[2,void 0]);case 1:return t=a.sent(),o=t.getScore(),r=t.getRank(),Toast.show({text:"順位は"+r+"位でした",delay:3e3}),[2,{bestScore:o,bestRank:r}]}})})},e}();__reflect(Social.prototype,"Social");var Description=function(e){function t(){var t=e.call(this,!1)||this,o=createLabel("色の違う\nパネルをタップ",{type:"stage",halign:"center",valign:"center",offsetY:-270},90,ColorPallet.UI_TEXT,!0);return t.addEgretDisplayObject(o),t}return __extends(t,e),t.prototype.onUpdate=function(){},t}(EgretGameObject);__reflect(Description.prototype,"Description");var LevelupOverlay=function(e){function t(){var t=e.call(this,!1)||this;t.container.anchorOffsetX=t.stageWidth/2,t.container.anchorOffsetY=t.stageHeight/2,t.container.x=t.container.anchorOffsetX,t.container.y=t.container.anchorOffsetY;var o=createRectShape(0,0,t.stageWidth,t.stageHeight,0,0);o.alpha=.8,t.addEgretDisplayObject(o);var r=createRectShape(100,300,t.stageWidth-200,t.stageHeight-600,15658734,32);t.addEgretDisplayObject(r),t.newLevel=createLabel("99",{type:"stage",valign:"center",halign:"center"},240,3355426,!0),t.addEgretDisplayObject(t.newLevel);var a=createLabel("レベルアップ",{type:"next-above",align:"center",anchor:t.newLevel,offsetY:-30},60,3355426);return t.addEgretDisplayObject(a),t.tapToStart=createLabel("タップする",{type:"next-below",anchor:t.newLevel,align:"center",offsetY:60},60,3355426,!0),t.addEgretDisplayObject(t.tapToStart),t}return __extends(t,e),t.prototype.show=function(e,t){setLabelText(this.newLevel,""+e.level),this.container.scaleX=0,this.container.scaleY=0,this.container.alpha=0,this.callback=t,this.visible=!0,egret.Tween.get(this.container,{loop:!1}).to({alpha:1,scaleX:1,scaleY:1},2*FramesOf4thNote*1e3/TheGame.FPS,egret.Ease.elasticOut).call(this.onShowed,this),egret.Tween.get(this.tapToStart,{loop:!0}).to({scaleX:.9,scaleY:.9},2*FramesOf4thNote*1e3/TheGame.FPS,getLfo(.1))},t.prototype.onTapped=function(){egret.Tween.get(this.container,{loop:!1}).to({alpha:0},1e3*FramesOf8thNote/TheGame.FPS,egret.Ease.cubicOut).call(this.onClosed,this)},t.prototype.onShowed=function(){this.enableTouch()},t.prototype.onClosed=function(){this.disableTouch(),this.visible=!1,this.callback.fn.apply(this.callback.thisObject)},t.prototype.onUpdate=function(){},t}(EgretGameObject);__reflect(LevelupOverlay.prototype,"LevelupOverlay");var ResultOverlay=function(e){function t(){var o=e.call(this,!1)||this;o.am=new AnimationManager(o,t.animatioins,"off");var r=createRectShape(0,0,o.stageWidth,o.stageHeight,ColorPallet.GAMEOVER_BACKGROUND,0);r.alpha=.8,o.addEgretDisplayObject(r);var a=createLabel(" ",{type:"stage",valign:"center",halign:"center"},240,ColorPallet.RESULT_TEXT_COLOR,!0);o.addEgretDisplayObject(o.yearOfAge=a);var n=createLabel("才",{type:"next-below",align:"center",anchor:a,offsetY:-30},40,ColorPallet.RESULT_TEXT_COLOR);o.addEgretDisplayObject(n);var s=createLabel(" ",{type:"next-below",align:"center",anchor:n,offsetY:30},120,ColorPallet.RESULT_TEXT_COLOR,!0);o.addEgretDisplayObject(o.daysOfAge=s);var i=createLabel("日",{type:"next-below",align:"center",anchor:s,offsetY:-5},40,ColorPallet.RESULT_TEXT_COLOR);o.addEgretDisplayObject(i);var l=createLabel("眼年齢",{type:"next-above",align:"center",anchor:a,offsetY:-30},40,ColorPallet.RESULT_TEXT_COLOR,!0);o.addEgretDisplayObject(l);var c=createLabel("累計スコア",{type:"stage",halign:"center",valign:"top",offsetY:20},20,ColorPallet.RESULT_TEXT_COLOR,!0);o.addEgretDisplayObject(c),o.commulativeScore=createLabel("99,999,999",{type:"stage",halign:"center",valign:"top",offsetY:60},100,ColorPallet.RESULT_TEXT_COLOR,!0),o.addEgretDisplayObject(o.commulativeScore);var h=createLabel("EXP",{type:"stage",halign:"center",valign:"top",offsetY:180},20,ColorPallet.RESULT_TEXT_COLOR,!0);return o.addEgretDisplayObject(h),o.commulativeExp=createLabel("9,999,999",{type:"stage",halign:"center",valign:"top",offsetY:220},100,ColorPallet.RESULT_TEXT_COLOR,!0),o.addEgretDisplayObject(o.commulativeExp),o.tapToStart=createLabel("タップする",{type:"stage",valign:"bottom",halign:"center",offsetY:-60},60,ColorPallet.RESULT_TEXT_COLOR,!0),o.addEgretDisplayObject(o.tapToStart),o.addChild(o.levelupOverlay=new LevelupOverlay),o.addChild(o.stageupOverlay=new StageupOverlay),o}return __extends(t,e),t.prototype.roulette=function(e){var o=t.animatioins["in"].frames+t.animatioins.roulette.frames,r=this.result,a=Math.floor(easeOut(r.commulativeExp.from,r.commulativeExp.to)(e,o));setLabelText(this.commulativeExp,comma(a));var n=Math.floor(easeOut(r.commulativeScore.from,r.commulativeScore.to)(e,o));setLabelText(this.commulativeScore,comma(n)),setLabelText(this.yearOfAge,Math.floor(100*Math.random()+1).toString()),setLabelText(this.daysOfAge,Math.floor(365*Math.random()+1).toString())},t.prototype.show=function(e){this.result=e,this.am.next("in")},t.prototype.onStarted=function(){return setLabelText(this.yearOfAge,""+this.result.years),setLabelText(this.daysOfAge,""+this.result.days),this.result.isLevelUped?void this.showLevelup():this.result.isStageUped?void this.showStageup():void this.enableClose()},t.prototype.onLeveluped=function(){return console.log("onLeveluped"),this.result.isStageUped?void this.showStageup():void this.enableClose()},t.prototype.onStageuped=function(){console.log("onStageuped"),this.enableClose()},t.prototype.enableClose=function(){this.tapToStart.visible=!0,this.enableTouch()},t.prototype.showStageup=function(){console.log("showStageup"),this.stageupOverlay.show(this.result,{fn:this.onStageuped,thisObject:this})},t.prototype.showLevelup=function(){console.log("showLevelup"),this.levelupOverlay.show(this.result,{fn:this.onLeveluped,thisObject:this})},t.prototype.onTapped=function(){"on"===this.am.state&&this.am.next("out")},t.prototype.onUpdate=function(){this.am.update()},t.animatioins={off:{frames:-1},"in":{frames:1*FramesOf4thNote,alphas:easeOut(0,1),onStart:function(e){e.visible=!0,e.tapToStart.visible=!1},onFrame:function(e,t){var o=t.counter;e.roulette(o)},onComplete:function(e,t){e.am.next("roulette")}},roulette:{frames:1*FramesOf4thNote,onFrame:function(e,o){var r=o.counter;e.roulette(r+t.animatioins["in"].frames)},onComplete:function(e,t){e.am.next("on")}},on:{frames:-1,onStart:function(e){e.onStarted()},onFrame:function(e,t){var o=t.counter,r=t.animation;e.tapToStart.alpha=lfo(.9,.1,8*FramesOf4thNote)(o,r.frames),e.tapToStart.scaleX=e.tapToStart.scaleY=lfo(1.1,.05,4*FramesOf4thNote)(o,r.frames)}},out:{frames:FramesOf16thNote,alphas:easeOut(1,0),onComplete:function(e){e.visible=!1,e.disableTouch(),e.am.next("off"),TheGame.gotoTitle()}}},t}(EgretGameObject);__reflect(ResultOverlay.prototype,"ResultOverlay");var RetryButtonInPlaying=function(e){function t(){return e.call(this,{x:EgretGameObject.stageWidth-.26*EgretGameObject.stageWidth,y:.16*EgretGameObject.stageWidth,width:.26*EgretGameObject.stageWidth,height:.12*EgretGameObject.stageWidth},60,.5,ColorPallet.BUTTON_LABEL,ColorPallet.BUTTON_BACKGROUND,"リトライ",!1)||this}return __extends(t,e),t.prototype.onTapped=function(){},t.prototype.onUpdate=function(){},t}(Button);__reflect(RetryButtonInPlaying.prototype,"RetryButtonInPlaying");var ScoreUI=function(e){function t(){var t=e.call(this,!0)||this;return t.score=null,t.best=null,t.position={x:0,y:0},t.score=createLabel("",{type:"stage",halign:"center",valign:"top",offsetY:20},180,ColorPallet.RESULT_TEXT_COLOR,!0),t.addEgretDisplayObject(t.score),t.best=createLabel("",{type:"next-below",anchor:t.score,align:"center",offsetY:0},30,ColorPallet.RESULT_TEXT_COLOR,!0),t.addEgretDisplayObject(t.best),t}return __extends(t,e),t.prototype.onDestroy=function(){this.score=void 0,this.best=void 0,e.prototype.onDestroy.call(this)},t.prototype.onUpdate=function(){setLabelText(this.score,comma(TheGame.score));var e;e=TheGame.player&&TheGame.player.bestRank?"BEST "+comma(TheGame.player.bestScore)+" "+comma(TheGame.player.bestRank)+"位":"BEST 0",setLabelText(this.best,e)},t}(EgretGameObject);__reflect(ScoreUI.prototype,"ScoreUI");var StageupOverlay=function(e){function t(){var t=e.call(this,!1)||this;t.container.anchorOffsetX=t.stageWidth/2,t.container.anchorOffsetY=t.stageHeight/2,t.container.x=t.container.anchorOffsetX,t.container.y=t.container.anchorOffsetY;var o=createRectShape(0,0,t.stageWidth,t.stageHeight,0,0);o.alpha=.8,t.addEgretDisplayObject(o);var r=createRectShape(100,300,t.stageWidth-200,t.stageHeight-600,15658734,32);t.addEgretDisplayObject(r),t.newStage=createLabel("99",{type:"stage",valign:"center",halign:"center"},240,3355426,!0),t.addEgretDisplayObject(t.newStage);var a=createLabel("次のステージに\n進みました",{type:"next-above",align:"center",anchor:t.newStage,offsetY:-30},60,3355426);return t.addEgretDisplayObject(a),t.tapToStart=createLabel("タップする",{type:"next-below",anchor:t.newStage,align:"center",offsetY:60},60,3355426,!0),t.addEgretDisplayObject(t.tapToStart),t}return __extends(t,e),t.prototype.show=function(e,t){setLabelText(this.newStage,""+e.stage),this.container.scaleX=0,this.container.scaleY=0,this.container.alpha=0,this.callback=t,this.visible=!0,egret.Tween.get(this.container,{loop:!1}).to({alpha:1,scaleX:1,scaleY:1},2*FramesOf4thNote*1e3/TheGame.FPS,egret.Ease.elasticOut).call(this.onShowed,this),egret.Tween.get(this.tapToStart,{loop:!0}).to({scaleX:.9,scaleY:.9},2*FramesOf4thNote*1e3/TheGame.FPS,getLfo(.1)),this.enableTouch()},t.prototype.onTapped=function(){egret.Tween.get(this.container,{loop:!1}).to({alpha:0},1e3*FramesOf8thNote/TheGame.FPS,egret.Ease.cubicOut).call(this.onClosed,this)},t.prototype.onShowed=function(){this.enableTouch()},t.prototype.onClosed=function(){this.disableTouch(),this.visible=!1,this.callback.fn.apply(this.callback.thisObject)},t.prototype.onUpdate=function(){},t}(EgretGameObject);__reflect(StageupOverlay.prototype,"StageupOverlay");var TimeLimit=function(e){function t(){var t=e.call(this,!1)||this;return t.timeText=null,t.timeText=createLabelOld(t.stageWidth/2,0,"",80,.5,ColorPallet.UI_TEXT,!0),t.timeText.anchorOffsetX=t.timeText.width/2,t.addEgretDisplayObject(t.timeText),t}return __extends(t,e),t.prototype.onUpdate=function(){this.timeText.text="TIME : "+TheGame.remaingMiliseconds.toFixed(1)},t}(EgretGameObject);__reflect(TimeLimit.prototype,"TimeLimit");var DefaultToastOptions={text:"",delay:3e3,canHide:!1},Toast=function(e){function t(t){var o=e.call(this)||this;return o.queue=[],o.rect=new eui.Rect,o.rect.alpha=0,o.label=new eui.Label,o.label.maxWidth=t,o.rect.addEventListener(eui.UIEvent.CREATION_COMPLETE,o.onRectCreationComplete,o),o.label.addEventListener(eui.UIEvent.RESIZE,o.onLabelResized,o),o.addChild(o.rect),egret.MainContext.instance.stage.addChild(o),o}return __extends(t,e),t.show=function(e){var o=__assign({},DefaultToastOptions,e);this.I||(this.I=new t(.6*Main.I.stage.width)),this.I.show(o)},t.destory=function(){var e=this.I;this.I=void 0,e&&(e.rect.removeChildren(),e.removeChildren(),e.rect=void 0,e.label=void 0)},t.prototype.show=function(e){if(console.log("Toast.show",e),this.currentOptions){if(!this.currentOptions.canHide)return void this.queue.push(e);this.currentTween.setPaused(!0),this.currentTween=void 0,this.currentOptions=void 0,this.queue=[]}this.currentOptions=e,this.toastText=e.text,this.visible=!0,egret.MainContext.instance.stage.setChildIndex(this,-1),this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:1},300).wait(e.delay).call(this.onStartHide,this)},t.prototype.onStartHide=function(){console.log("Toast.onStartHide"),void 0!==this.currentTween&&(this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:0},300).call(this.onCompleteHide,this))},t.prototype.onCompleteHide=function(){if(console.log("Toast.onCompleteHide"),this.currentTween=void 0,this.currentOptions=void 0,this.visible=!1,egret.MainContext.instance.stage.setChildIndex(this,0),0!==this.queue.length){var e=this.queue.shift();this.show(e)}},t.prototype.onRectCreationComplete=function(){console.log("Toast.onRectCreationComplete"),this.rect.fillColor=0,this.rect.fillAlpha=.6,this.rect.horizontalCenter=0,this.rect.verticalCenter=0,this.rect.ellipseWidth=30,this.rect.ellipseHeight=30,this.label.x=20,this.label.y=20,this.label.size=28,this.rect.addChild(this.label),this.toastText=""},Object.defineProperty(t.prototype,"toastText",{set:function(e){console.log("Toast.toastText:"),this.label.text=e},enumerable:!0,configurable:!0}),t.prototype.onLabelResized=function(){console.log("Toast.onLabelResized:"),this.rect.width=this.label.width+40,this.rect.height=this.label.height+40,this.rect.x=(Main.I.width-this.rect.width)/2,this.rect.y=(Main.I.height-this.rect.height)/2},t}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");